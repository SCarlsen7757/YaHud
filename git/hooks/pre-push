#!/bin/sh
# Pre-push hook to validate branch naming conventions
# This hook prevents pushing branches that don't follow the naming pattern

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get the current branch name
current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)

# Define valid branch patterns
valid_patterns=(
    "^main$"
    "^develop$"
    "^dev$"
    "^development$"
    "^features?/.+"
    "^(hotfix|hotfixes)/.+"
)

# Check if branch name matches any valid pattern
is_valid=false
for pattern in "${valid_patterns[@]}"; do
    if echo "$current_branch" | grep -qE "$pattern"; then
        is_valid=true
        break
    fi
done

if [ "$is_valid" = false ]; then
    echo "${RED}╔════════════════════════════════════════════════════════════╗${NC}"
    echo "${RED}║  ❌ INVALID BRANCH NAME                                    ║${NC}"
    echo "${RED}╚════════════════════════════════════════════════════════════╝${NC}"
    echo ""
    echo "${YELLOW}Branch name:${NC} ${RED}$current_branch${NC}"
    echo ""
    echo "${YELLOW}Valid branch naming patterns:${NC}"
    echo "  ${GREEN}✓${NC} main"
    echo "  ${GREEN}✓${NC} develop (or dev, development)"
    echo "  ${GREEN}✓${NC} feature/<description>  (e.g., feature/add-telemetry)"
    echo "  ${GREEN}✓${NC} features/<description> (e.g., features/widget/radar)"
    echo "  ${GREEN}✓${NC} hotfix/<description>   (e.g., hotfix/fix-crash)"
    echo "  ${GREEN}✓${NC} hotfixes/<description> (e.g., hotfixes/memory-leak)"
    echo ""
    echo "${YELLOW}Examples:${NC}"
    echo "  feature/add-radar-widget"
    echo "  feature/ui/improve-dashboard"
    echo "  hotfix/fix-telemetry-crash"
    echo ""
    echo "${YELLOW}To rename your branch:${NC}"
    echo "  git branch -m $current_branch feature/<new-name>"
    echo ""
    exit 1
fi

echo "${GREEN}✓${NC} Branch name is valid: ${GREEN}$current_branch${NC}"
exit 0
