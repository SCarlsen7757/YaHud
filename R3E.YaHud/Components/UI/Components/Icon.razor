@using System.IO
@using Microsoft.AspNetCore.Components
@using System.Text.RegularExpressions
@inject IWebHostEnvironment Env

@if (!string.IsNullOrEmpty(svgMarkup))
{
    <svg>
        @((MarkupString)svgMarkup)
    </svg>
}

@code {
    [Parameter] public required string Name { get; set; }

    private string? svgMarkup;
    private static readonly Dictionary<string, string> cache = new();

    protected override async Task OnParametersSetAsync()
    {
        if (string.IsNullOrWhiteSpace(Name))
            return;

        if (cache.TryGetValue(Name, out var cached))
        {
            svgMarkup = cached;
            return;
        }

        var file = Path.Combine(Env.WebRootPath, "assets", "fontawesome", "svgs-full", "solid", $"{Name}.svg");
        if (!File.Exists(file))
        {
            svgMarkup = null;
            return;
        }

        var raw = await File.ReadAllTextAsync(file);
        // (optional) strip XML declaration and inject class like before
        raw = Regex.Replace(raw, "<\\?xml.*?\\?>", string.Empty, RegexOptions.Singleline);
        cache[Name] = raw;
        svgMarkup = raw;
    }
}
